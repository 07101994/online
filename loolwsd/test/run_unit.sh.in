#!/bin/sh
#
# DO NOT EDIT - this file is generated from run_unit.sh.in.
#

export LOOL_LOGLEVEL=trace

abs_top_builddir="@abs_top_builddir@"

mkdir -p test_output

# result logging
echo > run_unit.sh.trs

for tst in timeout storage prefork; do
    tst_log="test_output/$tst.log"
    echo "Running test: $tst | $tst_log ...";
    if ../loolwsd --systemplate="@SYSTEMPLATE_PATH@" --lotemplate="@LO_PATH@" \
	          --childroot="@JAILS_PATH@" --unitlib=".libs/unit-$tst.so" 2> "$tst_log"; then
	echo "Test $tst passed."
	echo ":test-result: PASS $tst" >> run_unit.sh.trs
    else
	cat "$tst_log"
        echo "============================================================="
	echo "Test failed on unit: $tst re-run with:"
	echo "   $ gdb --args ../loolwsd --systemplate=\"@SYSTEMPLATE_PATH@\" --lotemplate=\"@LO_PATH@\" \\"
	echo "         --childroot=\"@JAILS_PATH@\" --unitlib=\".libs/unit-$tst.so\""
        echo "============================================================="
	echo ":test-result: FAIL $tst" >> run_unit.sh.trs
    fi
done

