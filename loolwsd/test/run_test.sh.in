#!/bin/sh
#
# DO NOT EDIT - this file is generated from run_test.sh.in.
#

abs_top_builddir="@abs_top_builddir@"
test_build="${abs_top_builddir}/test"
test_output="$test_build/run_test.sh.trs"
test_log_output="$test_build/test_output"

mkdir -p $test_log_output

if test "z@ENABLE_DEBUG@" != "ztrue"; then
    echo ""
    echo "It is necessary to configure with --enable-debug for unit tests to pass"
    echo ""
    echo ":test-result: FAIL $tst" > $test_output
    exit 1;
fi

# result logging
echo > $test_output

echo "Running cppunit test ...";

${abs_top_builddir}/loolwsd --systemplate="@SYSTEMPLATE_PATH@" --lotemplate="@LO_PATH@" \
           --childroot="@JAILS_PATH@" --allowlocalstorage 2>$test_log_output/run_test.log &

sleep 1 # sad - need to add a wait to the start of test.cpp ...

cd $test_build
if ./test; then
	echo "Test run_test.sh passed."
	echo ":test-result: PASS run_test.sh" >> $test_output
	retval=0
else
	cat $test_log_output/run_test.log
        echo "============================================================="
	echo "Test failed on unit:"
        echo "============================================================="
	echo ":test-result: FAIL run_test.sh" >> $test_output
	retval=1
fi

kill $!

exit $retval
